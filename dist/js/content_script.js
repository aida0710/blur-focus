(()=>{"use strict";const t={isBlur:!1,blurIntensity:5,targetElements:["h1","h2","h3","h4","h5","h6","p","a","span","ul","li","label","code"],siteList:[]};var e=function(t,e,s,r){return new(s||(s=Promise))((function(i,n){function o(t){try{u(r.next(t))}catch(t){n(t)}}function l(t){try{u(r.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,l)}u((r=r.apply(t,e||[])).next())}))};class s{constructor(){this.settings=t,this.mutationObserver=null,this.isActive=!1,this.targetSelector="",this.hoveredElement=null,this.handleMouseOver=t=>{const e=t.target;e.classList.contains("blur-focus-element")&&(this.hoveredElement=e,e.classList.add("blur-focus-hover"))},this.handleMouseOut=t=>{const e=t.target;if(!e.classList.contains("blur-focus-element"))return;const s=t.relatedTarget;s&&e.contains(s)||(e.classList.remove("blur-focus-hover"),this.hoveredElement=null)},this.init()}init(){return e(this,void 0,void 0,(function*(){try{if(yield this.loadSettings(),!this.isSiteEnabled())return;this.setupMessageListener(),this.settings.isBlur&&this.activate(),this.setupKeyboardShortcut()}catch(t){console.error("[Blur Focus] Initialization error:",t)}}))}loadSettings(){return e(this,void 0,void 0,(function*(){return new Promise(((e,s)=>{chrome.storage.local.get(null,(r=>{var i,n,o,l;chrome.runtime.lastError?s(chrome.runtime.lastError):(this.settings={isBlur:null!==(i=r.isBlur)&&void 0!==i?i:t.isBlur,blurIntensity:null!==(n=r.blurIntensity)&&void 0!==n?n:t.blurIntensity,targetElements:null!==(o=r.targetElements)&&void 0!==o?o:t.targetElements,siteList:null!==(l=r.siteList)&&void 0!==l?l:t.siteList},this.updateTargetSelector(),e())}))}))}))}isSiteEnabled(){if(0===this.settings.siteList.length)return!0;const t=window.location.href,e=window.location.hostname;for(const s of this.settings.siteList){const r=s.pattern;if(t.includes(r)||e.includes(r)||this.matchPattern(t,r))return s.enabled}return!0}matchPattern(t,e){const s=e.replace(/\*/g,".*").replace(/\?/g,".");try{return new RegExp(s).test(t)}catch(t){return!1}}updateTargetSelector(){this.targetSelector=this.settings.targetElements.join(",")}activate(){this.isActive||(this.isActive=!0,this.injectStyles(),this.applyBlurToExistingElements(),this.setupEventDelegation(),this.startMutationObserver())}deactivate(){this.isActive&&(this.isActive=!1,this.removeBlurFromAllElements(),this.removeEventDelegation(),this.stopMutationObserver())}injectStyles(){const t="blur-focus-styles",e=document.getElementById(t);e&&e.remove();const s=document.createElement("style");s.id=t,s.textContent=`\n      .blur-focus-element {\n        filter: blur(${this.settings.blurIntensity}px) !important;\n        transition: filter 0.2s ease !important;\n      }\n      .blur-focus-element.blur-focus-hover,\n      .blur-focus-element.blur-focus-hover * {\n        filter: none !important;\n      }\n    `,document.head.appendChild(s)}applyBlurToExistingElements(){this.targetSelector&&document.querySelectorAll(this.targetSelector).forEach((t=>{this.applyBlurToElement(t)}))}applyBlurToElement(t){t.classList.contains("blur-focus-element")||t.classList.add("blur-focus-element")}removeBlurFromElement(t){t.classList.remove("blur-focus-element","blur-focus-hover")}removeBlurFromAllElements(){document.querySelectorAll(".blur-focus-element").forEach((t=>{t.classList.remove("blur-focus-element","blur-focus-hover")}));const t=document.getElementById("blur-focus-styles");t&&t.remove()}setupEventDelegation(){document.addEventListener("mouseover",this.handleMouseOver),document.addEventListener("mouseout",this.handleMouseOut)}removeEventDelegation(){document.removeEventListener("mouseover",this.handleMouseOver),document.removeEventListener("mouseout",this.handleMouseOut)}startMutationObserver(){this.mutationObserver=new MutationObserver((t=>{t.forEach((t=>{t.addedNodes.forEach((t=>{if(t.nodeType===Node.ELEMENT_NODE){const e=t;e.matches&&e.matches(this.targetSelector)&&this.applyBlurToElement(e),e.querySelectorAll(this.targetSelector).forEach((t=>{this.applyBlurToElement(t)}))}}))}))})),this.mutationObserver.observe(document.body,{childList:!0,subtree:!0})}stopMutationObserver(){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null)}setupMessageListener(){chrome.runtime.onMessage.addListener(((t,e,s)=>{if("toggleBlur"===t.action||"updateSettings"===t.action)return this.handleSettingsUpdate(t.settings||{}).then((()=>{s({success:!0})})).catch((t=>{console.error("[Blur Focus] Settings update error:",t),s({success:!1,error:t.message})})),!0}))}handleSettingsUpdate(t){return e(this,void 0,void 0,(function*(){this.settings=Object.assign(Object.assign({},this.settings),t),this.updateTargetSelector(),this.isSiteEnabled()&&this.settings.isBlur?(this.isActive&&this.deactivate(),this.activate()):this.deactivate()}))}setupKeyboardShortcut(){document.addEventListener("keydown",(t=>{(t.ctrlKey||t.metaKey)&&t.shiftKey&&"B"===t.key&&(t.preventDefault(),this.toggleBlur())}))}toggleBlur(){this.settings.isBlur=!this.settings.isBlur,chrome.storage.local.set({isBlur:this.settings.isBlur},(()=>{chrome.runtime.lastError?console.error("[Blur Focus] Storage error:",chrome.runtime.lastError):this.settings.isBlur?this.activate():this.deactivate()}))}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{new s})):new s})();