(()=>{"use strict";const e={isBlur:!1,blurIntensity:5,targetElements:["h1","h2","h3","h4","h5","h6","p","a","span","ul","li","label","code"],siteList:[]};var t=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function l(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,l)}u((r=r.apply(e,t||[])).next())})};class s{constructor(){this.settings=e,this.mutationObserver=null,this.isActive=!1,this.targetSelector="",this.hoveredElement=null,this.handleMouseOver=e=>{let t=e.target;const s=[];for(;t&&t!==document.body;)t.classList.contains("blur-focus-element")&&s.push(t),t=t.parentElement;if(0===s.length)return;const r=s[0];if(this.hoveredElement!==r){if(this.hoveredElement){let e=this.hoveredElement;for(;e&&e!==document.body;)e.classList.contains("blur-focus-element")&&e.classList.remove("blur-focus-hover"),e=e.parentElement}this.hoveredElement=r,s.forEach(e=>{e.classList.add("blur-focus-hover")})}},this.handleMouseOut=e=>{const t=e.target,s=e.relatedTarget;if(!t.classList.contains("blur-focus-element"))return;if(this.hoveredElement!==t)return;if(s){if(t.contains(s))return;let e=s;for(;e&&e!==document.body;){if(e.classList.contains("blur-focus-element"))return;e=e.parentElement}}let r=this.hoveredElement;for(;r&&r!==document.body;)r.classList.contains("blur-focus-element")&&r.classList.remove("blur-focus-hover"),r=r.parentElement;this.hoveredElement=null},this.init()}init(){return t(this,void 0,void 0,function*(){try{if(yield this.loadSettings(),!this.isSiteEnabled())return;this.setupMessageListener(),this.settings.isBlur&&this.activate(),this.setupKeyboardShortcut()}catch(e){console.error("[Blur Focus] Initialization error:",e)}})}loadSettings(){return t(this,void 0,void 0,function*(){return new Promise((t,s)=>{chrome.storage.local.get(null,r=>{var n,i,o,l;chrome.runtime.lastError?s(chrome.runtime.lastError):(this.settings={isBlur:null!==(n=r.isBlur)&&void 0!==n?n:e.isBlur,blurIntensity:null!==(i=r.blurIntensity)&&void 0!==i?i:e.blurIntensity,targetElements:null!==(o=r.targetElements)&&void 0!==o?o:e.targetElements,siteList:null!==(l=r.siteList)&&void 0!==l?l:e.siteList},this.updateTargetSelector(),t())})})})}isSiteEnabled(){if(0===this.settings.siteList.length)return!0;const e=window.location.href,t=window.location.hostname;for(const s of this.settings.siteList){const r=s.pattern;if(e.includes(r)||t.includes(r)||this.matchPattern(e,r))return s.enabled}return!0}matchPattern(e,t){const s=t.replace(/\*/g,".*").replace(/\?/g,".");try{return new RegExp(s).test(e)}catch(e){return!1}}updateTargetSelector(){this.targetSelector=this.settings.targetElements.join(",")}activate(){this.isActive||(this.isActive=!0,this.injectStyles(),this.applyBlurToExistingElements(),this.setupEventDelegation(),this.startMutationObserver())}deactivate(){this.isActive&&(this.isActive=!1,this.removeBlurFromAllElements(),this.removeEventDelegation(),this.stopMutationObserver())}injectStyles(){const e="blur-focus-styles",t=document.getElementById(e);t&&t.remove();const s=document.createElement("style");s.id=e,s.textContent=`\n      .blur-focus-element {\n        filter: blur(${this.settings.blurIntensity}px) !important;\n        transition: filter 0.2s ease !important;\n      }\n      .blur-focus-element.blur-focus-hover,\n      .blur-focus-element.blur-focus-hover * {\n        filter: none !important;\n      }\n    `,document.head.appendChild(s)}applyBlurToExistingElements(){this.targetSelector&&document.querySelectorAll(this.targetSelector).forEach(e=>{this.applyBlurToElement(e)})}applyBlurToElement(e){e.classList.contains("blur-focus-element")||e.classList.add("blur-focus-element")}removeBlurFromElement(e){e.classList.remove("blur-focus-element","blur-focus-hover")}removeBlurFromAllElements(){document.querySelectorAll(".blur-focus-element").forEach(e=>{e.classList.remove("blur-focus-element","blur-focus-hover")});const e=document.getElementById("blur-focus-styles");e&&e.remove()}setupEventDelegation(){document.addEventListener("mouseover",this.handleMouseOver),document.addEventListener("mouseout",this.handleMouseOut)}removeEventDelegation(){document.removeEventListener("mouseover",this.handleMouseOver),document.removeEventListener("mouseout",this.handleMouseOut)}startMutationObserver(){this.mutationObserver=new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e;t.matches&&t.matches(this.targetSelector)&&this.applyBlurToElement(t),t.querySelectorAll(this.targetSelector).forEach(e=>{this.applyBlurToElement(e)})}})})}),this.mutationObserver.observe(document.body,{childList:!0,subtree:!0})}stopMutationObserver(){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null)}setupMessageListener(){chrome.runtime.onMessage.addListener((e,t,s)=>{if("toggleBlur"===e.action||"updateSettings"===e.action)return this.handleSettingsUpdate(e.settings||{}).then(()=>{s({success:!0})}).catch(e=>{console.error("[Blur Focus] Settings update error:",e),s({success:!1,error:e.message})}),!0})}handleSettingsUpdate(e){return t(this,void 0,void 0,function*(){this.settings=Object.assign(Object.assign({},this.settings),e),this.updateTargetSelector(),this.isSiteEnabled()&&this.settings.isBlur?(this.isActive&&this.deactivate(),this.activate()):this.deactivate()})}setupKeyboardShortcut(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.shiftKey&&"B"===e.key&&(e.preventDefault(),this.toggleBlur())})}toggleBlur(){this.settings.isBlur=!this.settings.isBlur,chrome.storage.local.set({isBlur:this.settings.isBlur},()=>{chrome.runtime.lastError?console.error("[Blur Focus] Storage error:",chrome.runtime.lastError):this.settings.isBlur?this.activate():this.deactivate()})}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new s}):new s})();